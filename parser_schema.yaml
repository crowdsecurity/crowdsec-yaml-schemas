$schema: "http://json-schema.org/draft-04/schema"
id: "http://stsci.edu/schemas/yaml-schema/draft-01"
title: "CrowdSec Parser"
type: "object"
properties: 
  onsuccess:
    type: string
    description: "If node is successful and onsuccess equals next_stage, event is moved to the next stage"
    pattern: "^next_stage$"
  debug:
    type: boolean
    description: "If true, enables the debug. Default is false."
  filter:
    type: string
    description: |
      filter must be a valid expr expression that will be evaluated against the event.
      If filter evaluation returns true or is absent, node will be processed.
      If filter returns false or a non-boolean, node won't be processed.
  description:
    type: string
    description: "description of the parser usage"
  pattern_syntax:
    type: object
    patternProperties:
      "^[A-Z][A-Z_]*$":
        type: string
    additionalProperties: false
  name:
    type: string
  grok:
    type: object
    properties:
      - oneOf:
          - name:
              type: string
          - pattern:
              type: string
      - oneOf:
          - apply_on:
              type: string
          - expression:
              type: string
  statics:
    type: array
    items:
      - oneOf:
          - meta:
              type: string
          - parsed:
              type: string
          - enriched:
              type: string
          - target:
              type: string
      - oneOf:
          - value:
              type: string
          - value:
              type: string
  data:
    type: object
    properties:
      source_url:
        type: string
      dest_file:
        type: string
      type:
        pattern: "^(type|regex)$"
        type: string
    required:
      - type
      - dest_file
  nodes:
    type: object
    items:
      "$ref": "#"
